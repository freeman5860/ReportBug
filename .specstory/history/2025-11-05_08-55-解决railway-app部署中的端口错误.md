<!-- Generated by SpecStory -->

# 解决railway.app部署中的端口错误 (2025-11-05 16:55:11)

_**User**_

这个工程部署到railway.app后访问不了，deploy log



Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

---

_**Assistant**_



---


检查相关配置文件，查找 `$PORT` 未正确展开的原因。


---

Read file: undefined

---

Read file: undefined

---

Read file: undefined

---



---



---


检查配置文件：


---

Read file: undefined

---



---


问题在于 `railway.toml` 中的 `$PORT` 未正确展开。修复：使用 Python 代码读取环境变量，而不是在命令行中使用 `$PORT`。更新配置：


---



---



---


改用更可靠的方法：创建启动脚本，从环境变量读取端口：


---



---



---



---


检查语法错误：


---



---



---


已修复部署问题。

## 问题原因
`railway.toml` 中直接使用 `$PORT` 时，Railway 可能未正确展开环境变量，导致 `uvicorn` 收到字符串 `'$PORT'` 而非实际端口号。

## 解决方案
1. 创建了 `start.py` 启动脚本，从环境变量读取 `PORT`（如果未设置则使用默认值 8000）
2. 修改了 `railway.toml`，使用 `python start.py` 作为启动命令

这样端口号会通过 Python 代码从环境变量读取，避免命令行展开问题。

## 修改的文件
- 创建了 `start.py`：启动脚本，读取 `PORT` 环境变量
- 修改了 `railway.toml`：将启动命令改为 `python start.py`

现在可以重新部署到 Railway。应用会正确读取 `PORT` 环境变量并启动服务。

---

_**User**_

可以了，那在iOS端应该怎么调，生成一份接口API文档，存到markdown

---

_**Assistant**_



---


查看所有 API 接口和数据结构，生成 iOS 端 API 文档。


---

Read file: undefined

---

Read file: undefined

---



---


查看统计接口的返回格式：


---

Read file: undefined

---



---


生成 iOS API 文档：


---



---



---


已生成 iOS API 文档，保存在 `API_DOCUMENTATION.md`。

## 文档内容包含：

1. **API 概述** - 基础信息和 Base URL 配置
2. **数据模型** - 所有请求和响应模型的定义
3. **接口文档** - 7 个接口的详细说明：
   - 首页
   - 创建问题
   - 获取问题列表（支持日期筛选）
   - 获取问题详情
   - 删除问题
   - 获取统计信息
   - 导出问题（Excel 文件）
4. **错误处理** - 标准错误响应格式和状态码说明
5. **iOS 调用示例** - 完整的 Swift 代码示例：
   - API 管理器类
   - 数据模型定义
   - 所有接口的调用方法
   - 使用示例和日期格式化工具

## 使用说明：

1. 将文档中的 `https://your-railway-app.railway.app` 替换为你的实际 Railway 部署地址
2. 可以直接复制 Swift 代码到你的 iOS 项目中使用
3. 所有接口都支持 CORS，可以直接从 iOS 应用调用

文档已保存，可直接使用。如需调整，请告知。

---



---

