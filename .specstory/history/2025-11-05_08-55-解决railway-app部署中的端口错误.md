<!-- Generated by SpecStory -->

# 解决railway.app部署中的端口错误 (2025-11-05 16:55:11)

_**User**_

这个工程部署到railway.app后访问不了，deploy log



Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

Usage: uvicorn [OPTIONS] APP

Try 'uvicorn --help' for help.

Error: Invalid value for '--port': '$PORT' is not a valid integer.

---

_**Assistant**_



---


检查相关配置文件，查找 `$PORT` 未正确展开的原因。


---

Read file: undefined

---

Read file: undefined

---

Read file: undefined

---



---



---


检查配置文件：


---

Read file: undefined

---



---


问题在于 `railway.toml` 中的 `$PORT` 未正确展开。修复：使用 Python 代码读取环境变量，而不是在命令行中使用 `$PORT`。更新配置：


---



---



---


改用更可靠的方法：创建启动脚本，从环境变量读取端口：


---



---



---



---


检查语法错误：


---



---



---


已修复部署问题。

## 问题原因
`railway.toml` 中直接使用 `$PORT` 时，Railway 可能未正确展开环境变量，导致 `uvicorn` 收到字符串 `'$PORT'` 而非实际端口号。

## 解决方案
1. 创建了 `start.py` 启动脚本，从环境变量读取 `PORT`（如果未设置则使用默认值 8000）
2. 修改了 `railway.toml`，使用 `python start.py` 作为启动命令

这样端口号会通过 Python 代码从环境变量读取，避免命令行展开问题。

## 修改的文件
- 创建了 `start.py`：启动脚本，读取 `PORT` 环境变量
- 修改了 `railway.toml`：将启动命令改为 `python start.py`

现在可以重新部署到 Railway。应用会正确读取 `PORT` 环境变量并启动服务。

---



---

